# 第一章 前置基础知识 - HTTP

## 1. HTTP 协议

HTTP（HyperText Transfer Protocol，超文本传输协议）是**用于在客户端（如浏览器）和服务器之间传输超文本（如 HTML、图片、视频）的应用层协议**，是 Web 通信的核心基础。在网络安全领域，HTTP 协议的安全性直接影响 Web 应用的安全（如 HTTP 明文传输易导致数据泄露，衍生出 HTTPS 协议），因此掌握 HTTP 协议原理是学习 Web 安全的关键前提。

### 1.1 认识 HTTP

HTTP 具有以下核心特性，这些特性既决定了其易用性，也带来了一定的安全风险：



*   **无状态**：协议本身不记录客户端的会话信息（如用户登录状态），每次请求都是独立的。服务器需通过 Cookie、Session 等机制实现状态保持（这也是会话劫持、CSRF 等漏洞的根源之一）。

*   **明文传输**：HTTP 传输的数据（包括请求参数、用户密码等）均为明文，未经过加密处理。攻击者可通过抓包工具（如 Wireshark、Fiddler）直接窃取传输内容（后续将通过实验验证）。

*   **基于请求 - 响应模型**：通信由客户端发起请求，服务器接收请求后返回响应，全程为 “单向交互”（客户端不主动接收服务器的被动推送，需借助 WebSocket 等技术实现双向通信）。

*   **可扩展**：HTTP 允许通过自定义请求头、响应头扩展功能（如 `Authorization` 头用于身份验证，`Cache-Control` 头用于缓存控制）。

### 1.2 HTTP 工作流程

HTTP 通信遵循 “请求 - 响应” 的标准流程，以 “浏览器访问百度首页” 为例，完整流程如下：



1.  **用户发起请求**：用户在浏览器地址栏输入 `www.baidu.com` 并按下回车，浏览器作为客户端开始构建 HTTP 请求。

2.  **DNS 域名解析**：浏览器需将域名 `www.baidu.com` 转换为服务器的 IP 地址（如 `180.101.50.188`），此过程通过 DNS 服务完成。

3.  **建立 TCP 连接**：浏览器与目标服务器的 80 端口（HTTP 默认端口）建立 TCP 连接（遵循三次握手协议，确保通信链路可靠）。

4.  **发送 HTTP 请求**：浏览器向服务器发送 HTTP 请求报文（包含请求方法、请求头、请求体等信息），请求百度首页的 HTML 资源。

5.  **服务器处理请求**：服务器接收请求后，解析请求内容，找到对应的资源（百度首页 HTML），并构建 HTTP 响应报文。

6.  **返回 HTTP 响应**：服务器通过 TCP 连接将响应报文发送给浏览器。

7.  **关闭 TCP 连接**：若为 HTTP/1.1 且未开启长连接（`Connection: keep-alive`），则通信完成后关闭 TCP 连接（遵循四次挥手协议）。

8.  **客户端渲染页面**：浏览器解析响应报文中的 HTML 内容，加载图片、CSS、JavaScript 等资源，最终渲染出百度首页。

### 1.3 URL 结构

URL（Uniform Resource Locator，统一资源定位符）是用于定位互联网中资源的地址，用户通过 URL 告诉客户端 “要访问哪个服务器的哪个资源”。HTTP 协议对应的 URL 结构如下（以 `http://www.example.com:8080/path/index.html?id=1&name=test#top` 为例）：



| 组成部分  | 示例内容               | 说明                                                        |
| ----- | ------------------ | --------------------------------------------------------- |
| 协议方案  | `http`             | 表示使用 HTTP 协议，常见的还有 `https`（加密版 HTTP）、`ftp`（文件传输协议）        |
| 服务器域名 | `www.example.com`  | 服务器的域名（需通过 DNS 解析为 IP 地址），也可直接使用 IP 地址（如 `192.168.1.100`） |
| 端口号   | `8080`             | 服务器的端口号，HTTP 默认端口为 80（可省略），HTTPS 默认端口为 443（可省略）           |
| 资源路径  | `/path/index.html` | 服务器上资源的具体路径，用于定位服务器内的文件或接口                                |
| 查询参数  | `id=1&name=test`   | 客户端向服务器传递的键值对参数，以 `?` 开头，多个参数用 `&` 分隔（GET 请求的参数通常放在此处）    |
| 锚点    | `#top`             | 用于定位页面内的指定位置（如页面顶部、某个章节），**锚点不发送给服务器**（仅在客户端解析）           |

### 1.4 URL、URI、URN 的区别

在学习 URL 时，常遇到 URI 和 URN 两个概念，三者的关系可概括为 “**URI 是父类，URL 和 URN 是子类**”，具体区别如下：



*   **URI（Uniform Resource Identifier，统一资源标识符）**：

    用于**唯一标识**互联网中的资源，仅关注 “资源是谁”，不关心 “如何访问”。URI 的格式更灵活，包含 URL 和 URN 两种形式。

    示例：`mailto:test@example.com`（邮件地址，属于 URI 但非 URL）、`http://www.example.com/index.html`（既是 URI 也是 URL）。

*   **URL（Uniform Resource Locator，统一资源定位符）**：

    是 URI 的子集，不仅能标识资源，还能**指定访问资源的协议和地址**（即 “如何访问资源”）。Web 开发中常用的地址（如浏览器地址栏的内容）均为 URL。

    示例：`https://www.baidu.com/s?wd=HTTP`。

*   **URN（Uniform Resource Name，统一资源名称）**：

    是 URI 的子集，通过**永久、唯一的名称**标识资源，与访问方式无关（即使资源的存储位置变化，URN 仍不变）。目前 URN 应用较少，典型示例为 ISBN 书号（如 `urn:isbn:9787115546926`，用于唯一标识某本书）。

三者关系示意图：

`URI ⊇ URL`，`URI ⊇ URN`，`URL` 与 `URN` 无交集。

## 2. HTTP 请求与响应

HTTP 通信的核心是 “请求报文” 和 “响应报文”，客户端发送请求报文，服务器返回响应报文，两者的格式遵循固定规范。

### 2.1 HTTP 请求报文

HTTP 请求报文是客户端发送给服务器的 “指令”，包含**请求行、请求头、空行、请求体**四部分（空行用于分隔请求头和请求体，必不可少），格式如下：



```
<请求行>

<请求头1>: <值1>

<请求头2>: <值2>

...

<空行>

<请求体>（可选，GET 请求无请求体，POST 请求常包含请求体）
```

#### 2.1.1 请求行

请求行是请求报文的第一行，包含**请求方法、请求 URI、HTTP 版本**三部分，用空格分隔，格式为：

`请求方法 请求URI HTTP版本`

示例：`GET /path/index.html HTTP/1.1`

#### 2.1.2 请求方法

请求方法用于告诉服务器 “客户端要执行的操作”，HTTP/1.1 定义了多种请求方法，常用方法及说明如下：



| 请求方法        | 作用                         | 安全 / 幂等性                      | 典型场景              |
| ----------- | -------------------------- | ----------------------------- | ----------------- |
| **GET**     | 获取服务器上的资源（如页面、数据）          | 安全（仅读取，不修改数据）、幂等（多次请求结果一致）    | 浏览器访问页面、查询数据（如搜索） |
| **POST**    | 向服务器提交数据（如表单提交、上传文件）       | 不安全（可能修改数据）、非幂等（多次请求可能产生不同结果） | 用户登录、注册、文件上传      |
| **PUT**     | 向服务器提交数据，用于**更新资源**（全量更新）  | 不安全、幂等                        | 更新用户信息（如修改昵称、手机号） |
| **DELETE**  | 通知服务器**删除资源**              | 不安全、幂等                        | 删除文章、删除用户账号       |
| **HEAD**    | 与 GET 类似，但服务器仅返回响应头，不返回响应体 | 安全、幂等                         | 检查资源是否存在、获取资源大小   |
| **OPTIONS** | 询问服务器支持的请求方法和功能            | 安全、幂等                         | CORS（跨域资源共享）预检请求  |



*   **安全**：指请求不会修改服务器上的数据，仅用于读取资源（GET、HEAD、OPTIONS 为安全方法）。

*   **幂等**：指多次执行相同的请求，结果与执行一次相同（GET、PUT、DELETE、HEAD、OPTIONS 为幂等方法）；POST 非幂等（如多次提交订单会创建多个订单）。

#### 2.1.3 GET 请求实例

GET 请求常用于获取资源，**无请求体**，参数通过 URL 的查询参数传递。以下是 “浏览器请求 `http://www.example.com/test?name=``张三&age=20`” 的 GET 请求报文（通过抓包工具获取）：



```
GET /test?name=张三\&age=20 HTTP/1.1

Host: www.example.com

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,\*/\*;q=0.8

Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2

Connection: keep-alive

Upgrade-Insecure-Requests: 1
```



*   请求行：`GET /test?name=张三&age=20 HTTP/1.1`（请求方法为 GET，请求 URI 包含查询参数，HTTP 版本为 1.1）。

*   请求头：包含 `Host`（目标服务器域名）、`User-Agent`（客户端浏览器信息）等。

*   空行：请求头后有一行空行（上述示例中请求头与结尾之间的空行未显式标出，实际存在）。

*   请求体：GET 请求无请求体，空行后无内容。

#### 2.1.4 POST 请求实例

POST 请求常用于提交数据，**有请求体**，参数可通过请求体传递（数据格式更灵活，支持表单、JSON 等）。以下是 “用户登录表单提交” 的 POST 请求报文（请求 `http://www.example.com/login`，提交参数 `username=test&password=123456`）：



```
POST /login HTTP/1.1

Host: www.example.com

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,\*/\*;q=0.8

Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2

Connection: keep-alive

Upgrade-Insecure-Requests: 1

Content-Type: application/x-www-form-urlencoded

Content-Length: 31

username=test\&password=123456
```



*   请求行：`POST /login HTTP/1.1`（请求方法为 POST，请求 URI 无查询参数，HTTP 版本为 1.1）。

*   请求头：新增 `Content-Type`（请求体数据格式，此处为表单格式）和 `Content-Length`（请求体长度，单位为字节）。

*   空行：请求头后的空行（`Content-Length: 31` 与请求体之间），用于分隔请求头和请求体。

*   请求体：`username=test&password=123456`（表单参数，与 GET 请求的查询参数格式类似，但放在请求体中）。

#### 2.1.5 POST 和 GET 的区别

GET 和 POST 是最常用的两种请求方法，两者的核心区别直接影响 Web 开发和安全测试（如 SQL 注入漏洞测试需区分请求方法），具体区别如下：



| 对比维度   | GET 方法                       | POST 方法                         |
| ------ | ---------------------------- | ------------------------------- |
| 参数位置   | 参数放在 URL 查询参数中（`?key=value`） | 参数放在请求体中（或 URL 中，不推荐）           |
| 参数可见性  | 可见（URL 会显示在浏览器地址栏、历史记录中）     | 不可见（请求体不显示在地址栏，需抓包查看）           |
| 参数大小限制 | 受浏览器 / 服务器限制（通常不超过 2KB）      | 无明确限制（由服务器配置决定，支持大文件上传）         |
| 缓存支持   | 可被浏览器缓存（如刷新页面不重新请求）          | 默认不被缓存（需通过 `Cache-Control` 头配置） |
| 安全风险   | 高（参数明文显示，易泄露敏感信息）            | 较低（参数隐藏在请求体，但仍为明文，需 HTTPS 加密）   |
| 用途     | 获取资源（如查询、浏览）                 | 提交数据（如登录、注册、上传）                 |
| 幂等性    | 幂等（多次请求结果一致）                 | 非幂等（多次请求可能产生不同结果）               |

#### 2.1.6 常用请求头列表

请求头用于向服务器传递客户端信息或请求配置，以下是 Web 安全中常用的请求头及说明：



| 请求头              | 作用                                                                              | 安全相关说明                                               |
| ---------------- | ------------------------------------------------------------------------------- | ---------------------------------------------------- |
| `Host`           | 指定目标服务器的域名和端口（如 `www.example.com:8080`）                                         | 用于服务器虚拟主机配置，是 HTTP/1.1 必需的请求头，缺失会导致请求失败              |
| `User-Agent`（UA） | 标识客户端的浏览器类型、操作系统版本等（如 Chrome、Windows）                                           | 服务器可通过 UA 判断客户端类型，攻击者可伪造 UA 绕过浏览器限制                  |
| `Accept`         | 告诉服务器客户端可接收的资源格式（如 `text/html`、`application/json`）                              | 影响服务器返回的响应格式，无直接安全风险                                 |
| `Referer`        | 标识当前请求的来源页面（如从 A 页面跳转到 B 页面，Referer 为 A 页面 URL）                                 | 用于防盗链、来源验证，攻击者可伪造 Referer 绕过来源检查（如 CSRF 防护）          |
| `Cookie`         | 携带客户端的 Cookie 信息（如用户登录会话 ID）                                                    | 核心安全头，Cookie 泄露会导致会话劫持，需通过 `HttpOnly`、`Secure` 等属性保护 |
| `Content-Type`   | 指定请求体的数据格式（如 `application/x-www-form-urlencoded` 为表单，`application/json` 为 JSON） | 影响服务器对请求体的解析，错误的 Content-Type 可能导致解析失败或漏洞（如文件上传漏洞）   |
| `Content-Length` | 指定请求体的长度（单位为字节）                                                                 | 服务器通过此头判断请求体是否完整，缺失可能导致请求超时                          |
| `Authorization`  | 携带身份验证信息（如 Basic 认证的 Base64 编码字符串、Bearer Token）                                 | 用于 API 身份验证，信息泄露会导致未授权访问，需 HTTPS 加密传输                |
| `Connection`     | 指定 TCP 连接的状态（`keep-alive` 为长连接，`close` 为短连接）                                    | 长连接可减少连接建立开销，但可能导致连接耗尽攻击                             |

### 2.2 HTTP 响应报文

HTTP 响应报文是服务器对客户端请求的 “回复”，包含**状态行、响应头、空行、响应体**四部分，格式如下：



```
<状态行>

<响应头1>: <值1>

<响应头2>: <值2>

...

<空行>

<响应体>（可选，如 HTML 页面、JSON 数据）
```

#### 2.2.1 状态行

状态行是响应报文的第一行，包含**HTTP 版本、状态码、状态描述**三部分，用空格分隔，格式为：

`HTTP版本 状态码 状态描述`

示例：`HTTP/1.1 200 OK`（HTTP 1.1 版本，状态码 200，状态描述为 OK）。

#### 2.2.2 响应实例

以下是服务器对 “GET 请求 `http://www.example.com/test`” 的响应报文（返回 HTML 页面）：



```
HTTP/1.1 200 OK

Server: nginx/1.20.1

Date: Wed, 10 Jul 2024 08:30:00 GMT

Content-Type: text/html; charset=utf-8

Content-Length: 156

Connection: keep-alive

Cache-Control: max-age=3600

\<!DOCTYPE html>

\<html lang="zh-CN">

\<head>

&#x20;   \<meta charset="UTF-8">

&#x20;   \<title>测试页面\</title>

\</head>

\<body>

&#x20;   \<h1>HTTP 响应测试\</h1>

&#x20;   \<p>这是服务器返回的 HTML 响应体内容\</p>

\</body>

\</html>
```



*   状态行：`HTTP/1.1 200 OK`（表示请求成功，HTTP 版本为 1.1）；

*   响应头：包含 `Server`（服务器软件版本）、`Content-Type`（响应体格式为 HTML，编码为 UTF-8）、`Cache-Control`（缓存有效期 3600 秒）等；

*   空行：`Cache-Control: max-age=3600` 与 HTML 内容之间的空行，分隔响应头与响应体；

*   响应体：HTML 代码，浏览器会解析并渲染为页面。
#### 2.2.3 常用响应头列表

响应头用于向客户端传递服务器信息或响应配置，部分响应头直接影响 Web 安全（如防盗链、Cookie 保护），常用响应头及说明如下：



| 响应头                | 作用                                                             | 安全相关说明                                                            |
| ------------------ | -------------------------------------------------------------- | ----------------------------------------------------------------- |
| `Server`           | 标识服务器使用的软件及版本（如 `nginx/1.20.1`、`Apache/2.4.49`）                | 暴露服务器版本可能让攻击者针对性利用漏洞（如已知的 nginx 漏洞），建议隐藏或修改此头                     |
| `Date`             | 服务器生成响应的时间（GMT 时区）                                             | 无直接安全风险，用于客户端判断响应时效性                                              |
| `Content-Type`     | 指定响应体的数据格式及编码（如 `text/html; charset=utf-8`、`application/json`） | 若未正确设置，可能导致浏览器 “MIME 类型嗅探”，引发 XSS 漏洞（如将 HTML 伪装为文本）               |
| `Content-Length`   | 指定响应体的长度（单位为字节）                                                | 客户端通过此头判断响应是否完整，缺失可能导致资源加载异常                                      |
| `Connection`       | 指定 TCP 连接状态（`keep-alive` 保持连接，`close` 关闭连接）                    | 长连接（`keep-alive`）可减少连接开销，但需注意连接数限制，避免被恶意占用                        |
| `Cache-Control`    | 控制客户端对响应的缓存策略（如 `max-age=3600` 表示缓存 1 小时，`no-cache` 表示不缓存）     | 合理设置可减少重复请求，但敏感资源（如登录页面）需设置 `no-cache`，避免缓存泄露                     |
| `Set-Cookie`       | 服务器向客户端设置 Cookie（如 `PHPSESSID=abc123; HttpOnly; Secure`）       | 核心安全头，通过 `HttpOnly` 防止 JS 窃取 Cookie（对抗 XSS），`Secure` 限制仅 HTTPS 传输 |
| `Location`         | 用于重定向（配合 3xx 状态码），指定客户端需跳转的目标 URL                              | 若重定向目标可控，可能导致 “开放重定向” 漏洞，引导用户访问钓鱼网站                               |
| `X-Frame-Options`  | 防止页面被嵌入 iframe（`DENY` 禁止嵌入，`SAMEORIGIN` 仅允许同域名嵌入）              | 对抗 “点击劫持” 漏洞，必须配置此头保护敏感页面（如支付、登录页面）                               |
| `X-XSS-Protection` | 启用浏览器内置 XSS 防护（`1; mode=block` 表示检测到 XSS 时阻止页面加载）              | 增强客户端 XSS 防护，虽不能替代服务器防护，但可作为补充                                    |

#### 2.2.4 状态码

HTTP 状态码是服务器通过状态行返回的 “请求处理结果标识”，由 3 位数字组成，分为 5 大类（1xx-5xx），不同类别对应不同的处理场景，在安全测试中可通过状态码判断请求是否被正常处理（如 403 表示权限拒绝，404 表示资源不存在）。

##### 状态码分类及常用示例



| 类别  | 含义       | 常用状态码                     | 说明                                       |
| --- | -------- | ------------------------- | ---------------------------------------- |
| 1xx | 信息性状态码   | 100 Continue              | 服务器已接收请求头，客户端可继续发送请求体（仅用于 POST 等带请求体的请求） |
| 2xx | 成功状态码    | 200 OK                    | 请求成功，服务器返回预期响应（如 HTML 页面、JSON 数据）        |
|     |          | 204 No Content            | 请求成功，但无响应体（常用于 DELETE 请求，仅返回处理结果）        |
| 3xx | 重定向状态码   | 301 Moved Permanently     | 资源永久迁移，客户端需使用新 URL 访问（浏览器会缓存新 URL）       |
|     |          | 302 Found                 | 资源临时迁移，客户端需临时使用新 URL 访问（浏览器不缓存）          |
|     |          | 304 Not Modified          | 资源未修改（客户端缓存仍有效），服务器不返回响应体（减少传输开销）        |
| 4xx | 客户端错误状态码 | 400 Bad Request           | 请求格式错误（如请求体语法错误、参数缺失）                    |
|     |          | 401 Unauthorized          | 请求未授权（需先登录或提供认证信息，如未携带 Token）            |
|     |          | 403 Forbidden             | 请求被拒绝（已授权，但权限不足，如普通用户访问管理员页面）            |
|     |          | 404 Not Found             | 请求的资源不存在（如 URL 路径错误、文件已删除）               |
|     |          | 405 Method Not Allowed    | 请求方法不被支持（如服务器仅允许 GET 请求，客户端用了 POST）      |
| 5xx | 服务器错误状态码 | 500 Internal Server Error | 服务器内部错误（如代码 bug、数据库连接失败，最常见的服务器错误）       |
|     |          | 502 Bad Gateway           | 网关错误（服务器作为网关时，无法连接后端服务，如反向代理后端宕机）        |
|     |          | 503 Service Unavailable   | 服务器暂时不可用（如服务器过载、维护中，通常会返回重试时间）           |
|     |          | 504 Gateway Timeout       | 网关超时（服务器作为网关时，后端服务响应超时）                  |

##### 安全测试中的状态码应用



*   测试登录接口时，输入错误密码若返回 401，说明服务器正确识别 “未授权”；若返回 200 但提示 “密码错误”，需注意响应内容是否泄露敏感信息；

*   访问未授权页面时，若返回 403 而非 200，说明权限控制有效；若返回 302 重定向到登录页，需检查重定向目标是否合法（防止开放重定向）；

*   发送异常请求（如参数含特殊字符）时，若返回 500，可能存在代码漏洞（如未处理异常，可进一步测试是否能触发 SQL 注入、命令执行等漏洞）。
